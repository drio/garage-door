<html>
<!DOCTYPE html>
<!--vim: set ts=4 sw=4 et:-->
<meta charset="utf-8">
<meta name="viewport" content="width=800">

<style>
html {
    margin: 0;
    border: 50px; 
}

body {
    font: 16px/1.5em "Helvetica Neue", Helvetica, sans-serif;
    margin: 1em 0 4em 0;
}

#image-area {
    margin-top: 10px;    
}

#main {
    padding: 50px;
}
</style>

<div id="main">
    <div id="buttons">
        <button id="toggle">toggle</button>
        <button id="capture">capture</button>
    </div>
    <div id="image-area"> <img src="" alt=""> </div>
    <p id="info"> Ready.
</div>

</html>

<script src="/socket.io/socket.io.js"></script>
<script src="js/d3.min.js"></script>
<script>

var socket    = io.connect('http://' + document.domain + ':' + location.port),
    log       = function(msg) { console.log(">> " + msg); },
    b64header = 'data:image/jpeg;base64,',
    info      = d3.select("#info");

d3.select("#toggle").on('click', function() {
    info.html("Toggling ...");
    socket.emit('toggle');
});


d3.select("#capture").on('click', function() {
    info.html("Adquiring image ...");
    socket.emit('image');
});


socket.on('connect', function() {
    log("Connected");
});

socket.on('answer-image', function(data) {
    if (data.error !== 0)
        info.html("Problems capturing image in server ");
    else {
        info.html("");
        d3.select("img").attr('src', b64header + data.payload);
    }
});

socket.on('answer-toggle', function(data) {
    if (data.error !== 0)
        info.html("Problems running toggle in server ");
    else 
        info.html('Toogle OK from server: ' + Date(Date.now())); 
});

</script>

